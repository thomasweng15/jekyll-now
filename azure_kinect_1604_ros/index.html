<!DOCTYPE html>
<html>
  <head>
    <title>How to install ROS drivers for Azure Kinect on Ubuntu 16.04 – Thomas Weng – adventures in computing, productivity, and ?</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Following up from my previous post on installing the Azure Kinect SDK on Ubuntu 16.04, this post provides instructions for setting up ROS drivers for the Azure Kinect. These instructions apply for ROS kinetic and Ubuntu 16.04.

" />
    <meta property="og:description" content="Following up from my previous post on installing the Azure Kinect SDK on Ubuntu 16.04, this post provides instructions for setting up ROS drivers for the Azure Kinect. These instructions apply for ROS kinetic and Ubuntu 16.04.

" />
    
    <meta name="author" content="Thomas Weng" />

    
    <meta property="og:title" content="How to install ROS drivers for Azure Kinect on Ubuntu 16.04" />
    <meta property="twitter:title" content="How to install ROS drivers for Azure Kinect on Ubuntu 16.04" />
    

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lora:normal,b,i,bi" rel="stylesheet">
    <script src="https://use.fontawesome.com/60beeb5aee.js" type="text/javascript"></script>

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" id="avadaredux-google-fonts-avada_theme_options-css" href="https://fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700italic%2C700%7CPT+Serif%3A400&amp;subset=latin" type="text/css" media="all">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Thomas Weng - adventures in computing, productivity, and ?" href="/feed.xml" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/contrib/auto-render.min.js" integrity="sha384-IiI65aU9ZYub2MY9zhtKd1H2ps7xxf+eb2YFG9lX6uRqpXCvBTOidPRCXCrQ++Uc" crossorigin="anonymous"></script>
    
    <link rel="shortcut icon" type="image/png" href="/favicon.png"  />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://avatars3.githubusercontent.com/u/1114539?v=3&s=140" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Thomas Weng</a></h1>
            <p class="site-description">adventures in computing, productivity, and ?</p>
          </div>

          <nav>
            <!-- <a href="/archive">Archive</a> -->
            <a href="/">Home</a>
            <a href="/blog">Blog</a>
            <a href="/cv">CV</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <div class="row">
<div class="col-sm-8">

<article class="post">
  <h1>How to install ROS drivers for Azure Kinect on Ubuntu 16.04</h1>

  <div class="author">
    <div>By Thomas Weng on August 31, 2019</div>
    
</div>



  <div class="content">
  <p>Following up from my previous post on <a href="../azure_kinect_1604">installing the Azure Kinect SDK on Ubuntu 16.04</a>, this post provides instructions for setting up ROS drivers for the Azure Kinect. These instructions apply for ROS kinetic and Ubuntu 16.04.</p>

<p>The credit for figuring out these steps goes to <a href="https://www.ri.cmu.edu/ri-people/kevin-zhang/">Kevin Zhang</a>!</p>

<h1 id="installation-steps">Installation steps</h1>
<ol>
  <li>Install the Azure Kinect SDK executables on your path so they can be found by ROS.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>path/to/Azure-Kinect-Sensor-SDK/build
<span class="gp">$</span> <span class="nb">sudo </span>ninja <span class="nb">install</span>
</code></pre></div>    </div>
  </li>
  <li>Clone the official ROS driver into a catkin workspace.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>catkin_ws/src
<span class="gp">$</span> git clone https://github.com/microsoft/Azure_Kinect_ROS_Driver.git
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make minor edits to the codebase. If you were to build the workspace now, you would get errors relating to <code class="highlighter-rouge">std::atomic</code> syntax.</p>

    <p>To fix this, open <code class="highlighter-rouge">&lt;repo&gt;/include/azure_kinect_ros_driver/k4a_ros_device.h</code> and convert all instances of <code class="highlighter-rouge">std::atomic_TYPE</code> type declarations to <code class="highlighter-rouge">std::atomic&lt;TYPE&gt;</code>. Below is a diff of the edits I made.</p>
    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">@@</span> <span class="o">-</span><span class="mi">117</span><span class="p">,</span><span class="mi">11</span> <span class="o">+</span><span class="mi">117</span><span class="p">,</span><span class="mi">11</span> <span class="err">@@</span> <span class="k">class</span> <span class="nc">K4AROSDevice</span>
  <span class="k">volatile</span> <span class="kt">bool</span> <span class="n">running_</span><span class="p">;</span>
 
  <span class="c1">// Last capture timestamp for synchronizing playback capture and imu thread</span>
       <span class="o">-</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic_int64_t</span> <span class="n">last_capture_time_usec_</span><span class="p">;</span>
       <span class="o">+</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">last_capture_time_usec_</span><span class="p">;</span>
 
  <span class="c1">// Last imu timestamp for synchronizing playback capture and imu thread</span>
       <span class="o">-</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic_uint64_t</span> <span class="n">last_imu_time_usec_</span><span class="p">;</span>
       <span class="o">-</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic_bool</span> <span class="n">imu_stream_end_of_file_</span><span class="p">;</span>
       <span class="o">+</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span> <span class="n">last_imu_time_usec_</span><span class="p">;</span>
       <span class="o">+</span>    <span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">imu_stream_end_of_file_</span><span class="p">;</span>
 
  <span class="c1">// Threads</span>
  <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">frame_publisher_thread_</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Build the catkin workspace with either <code class="highlighter-rouge">catkin_make</code> or <code class="highlighter-rouge">catkin build</code>.</p>
  </li>
  <li>Copy the libdepthengine and libstdc++ binaries that you placed in the <code class="highlighter-rouge">Azure_Kinect_SDK/build/bin</code> folder from my <a href="../azure_kinect_1604">previous post</a> in your catkin workspace.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cp </span>path/to/Azure_Kinect_SDK/build/bin/libdepthengine.so.1.0 path/to/catkin_ws/devel/lib/
<span class="gp">$</span> <span class="nb">cp </span>path/to/Azure_Kinect_SDK/build/bin/libstdc++.so.6 path/to/catkin_ws/devel/lib/
</code></pre></div>    </div>

    <p>You will have to do this whenever you do a clean build of your workspace.</p>
  </li>
  <li>Copy udev rules from the ROS driver repo to your machine.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cp</span> /path/to/Azure_Kinect_ROS_Driver/scripts/99-k4a.rules /etc/udev/rules.d/
</code></pre></div>    </div>

    <p>Unplug and replug your sensor into the machine after copying the file over.</p>
  </li>
  <li>Source your built workspace and launch the driver.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">source </span>path/to/catkin_ws/devel/setup.bash
<span class="gp">$</span> roslaunch azure_kinect_ros_driver driver.launch
</code></pre></div>    </div>

    <p>Note that there are parameters you can adjust in the driver launch file, e.g. fps, resolution, etc.</p>
  </li>
  <li>Run Rviz and you should be able to open Image and PointCloud2 widgets that read topics from the sensor!</li>
</ol>

<div class="cntr">
  <img src="../assets/19-08-29_1.png" />
  <div class="caption">
    Screenshot from RViz
  </div>
</div>


  </div>

</article>

  
<div class="tags">
    Tags:
   
    <span class="tag"><a href="/tag/robotics">robotics</a></span>
   
</div>



  <div class="row pagenav">
      
      <div class="col-xs-6 prev_post"><a href="/terminal_tips/">&larr; Terminal tips</a></div>
      
      
  </div>


  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'http-thomasweng-com';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



  </div>

  	 <div class="sidebar col-sm-4">
	   <h1>Recent Posts</h1>

	   <ul>
	     
	     <li><a href="/azure_kinect_1604_ros/">How to install ROS drivers for Azure Kinect on Ubuntu 16.04</a></li>
	     
	     <li><a href="/terminal_tips/">Terminal tips</a></li>
	     
	     <li><a href="/azure_kinect_1604/">How to install the Azure Kinect SDK on Ubuntu 16.04</a></li>
	     
	     <li><a href="/calendar_time_log/">Using my calendar as a time log</a></li>
	     
	     <li><a href="/staying_on_top_of_email/">Staying on top of email</a></li>
	     
	   </ul>

	   <h1>Most Popular</h1>
	   <ul>
	     
	     <li><a href="/journaling/">How I Journal</a></li>
	     
	     <li><a href="/on_password_managers/">You Should Use a Password Manager</a></li>
	     
	   </ul>

	   <h1>Topics</h1>
	   <ul>
	     
	     
	     
	     
	     <li><a href="/tag/blogging">blogging</a> (1)</li>
	     
	     
	     
	     
	     <li><a href="/tag/machine learning">machine learning</a> (1)</li>
	     
	     
	     
	     
	     
	     
	     <li><a href="/tag/productivity">productivity</a> (6)</li>
	     
	     
	     
	     
	     <li><a href="/tag/programming">programming</a> (1)</li>
	     
	     
	     
	     
	     <li><a href="/tag/robotics">robotics</a> (4)</li>
	     
	     
	     
	     
	     <li><a href="/tag/security">security</a> (1)</li>
	     
	     
	   </ul>

	 </div>

  
</div>


    </div>

    <div class="wrapper-footer">
      <div class="footer">
          
<a href="mailto:thomas.weng11@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/thomasweng15"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/thomasweng"><i class="svg-icon linkedin"></i></a>

<a href="/feed.xml"><i class="svg-icon rss"></i></a>




      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-50853593-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/azure_kinect_1604_ros/',
		  'title': 'How to install ROS drivers for Azure Kinect on Ubuntu 16.04'
		});
	</script>
	<!-- End Google Analytics -->


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" type="text/javascript"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
    <script>
      renderMathInElement(document.body);
    </script>
  </body>
</html>
